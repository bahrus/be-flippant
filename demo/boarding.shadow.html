<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Boarding</title>
    
  </head>
  <body>
    <template shadowroot='open'>
        <link rel="stylesheet" href="./boarding.css" />
        <div id="app" data-state="tickets">
            <div class="layer -tickets" data-show="tickets">
                <div class="ticket -bg" data-flip-key="ticket">
                <div class="qrcode" data-flip-key="qr"></div>
                </div>
            </div>
            <div class="layer -ticket" data-show="ticket">
                <div class="full-ticket -bg" data-flip-key="ticket">
                <div class="qrcode" data-flip-key="qr"></div>
                </div>
            </div>
        </div>
    </template>
  </body>
  <script type='module'>
    import {Flipping} from '../Flipping.js';
    const flipping = new Flipping();
    const root = document.body.shadowRoot;
    const elApp = root.querySelector('#app');
    function activate(state) {
      elApp.dataset.state = state;

      root.querySelectorAll('[data-active]').forEach(el => {
        el.removeAttribute('data-active');
      });

      root
        .querySelectorAll(
          `[data-show~="${state}"], [data-hide]:not([data-hide~="${state}"])`
        )
        .forEach(el => {
          el.setAttribute('data-active', true);
        });
    }

    const machine = {
      initial: 'tickets',
      states: {
        tickets: {
          on: { CLICK: 'ticket' }
        },
        ticket: {
          on: { CLICK: 'tickets' }
        }
      }
    };

    let current = machine.initial;

    activate(current);

    elApp.addEventListener(
      'click',
      flipping.wrap(() => {
        current = machine.states[current].on['CLICK'];
        activate(current);
      })
    );
  </script>
</html>